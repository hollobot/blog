# é¡¹ç›®éš¾ç‚¹ï¼ˆæŠ€æœ¯éš¾ç‚¹ï¼‰

> éš¾ç‚¹è¦ä½“ç°ä½ åœ¨**é«˜å¹¶å‘ã€åˆ†å¸ƒå¼ã€ç½‘ç»œé€šä¿¡ã€çŠ¶æ€ä¸€è‡´æ€§**ç­‰å±‚é¢çš„æ€è€ƒã€‚
>  å¯ä»¥é€‰æ‹©ä¸€ä¸ªæˆ–ä¸¤ä¸ªé‡ç‚¹å±•å¼€ã€‚

## **éš¾ç‚¹ 1ï¼šWebSocket é•¿è¿æ¥ç®¡ç†ä¸æ¶ˆæ¯å¯é æŠ•é€’**

åœ¨é¡¹ç›®ä¸­ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½ä¼šä¸æœåŠ¡ç«¯å»ºç«‹ä¸€ä¸ªé•¿è¿æ¥ã€‚å½“ç”¨æˆ·é‡è¾ƒå¤§æ—¶ï¼Œç®¡ç†è¿™äº›è¿æ¥çš„çŠ¶æ€ã€å¿ƒè·³ã€å¼‚å¸¸æ–­å¼€é‡è¿æ˜¯ä¸ªæŒ‘æˆ˜ã€‚
 **è§£å†³æ€è·¯ï¼š**

- ä½¿ç”¨ **Netty + Redis + Redisson** æ¥å®ç°åˆ†å¸ƒå¼è¿æ¥ç®¡ç†ï¼›
- æ¯ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ª `userId â†’ channel` æ˜ å°„ï¼›
- å®šæ—¶å‘é€å¿ƒè·³åŒ…æ£€æµ‹è¿æ¥çŠ¶æ€ï¼Œè‡ªåŠ¨æ¸…ç†è¶…æ—¶è¿æ¥ï¼›
- åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œé‡‡ç”¨ **æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆACKï¼‰** ä¿è¯æ¶ˆæ¯å¯é é€è¾¾ï¼Œè‹¥ç”¨æˆ·ç¦»çº¿åˆ™å­˜å…¥ Redis ç¦»çº¿é˜Ÿåˆ—ï¼Œç”¨æˆ·ä¸Šçº¿åè‡ªåŠ¨æ¨é€è¡¥å¿ã€‚

ğŸ§  **äº®ç‚¹å…³é”®è¯**ï¼š

> â€œåˆ†å¸ƒå¼ WebSocket ç®¡ç†â€ã€â€œå¿ƒè·³æ£€æµ‹â€ã€â€œæ¶ˆæ¯ ACKâ€ã€â€œç¦»çº¿è¡¥å¿æœºåˆ¶â€ã€‚

------

### å®ç°é€»è¾‘

 ä½ ç°åœ¨è¦çš„æ˜¯ä¸€ä¸ª **å®Œæ•´å¯è¿è¡Œçš„â€œæ¶ˆæ¯å¯é æŠ•é€’ + ACK ç¡®è®¤ + è‡ªåŠ¨é‡å‘æœºåˆ¶â€ç¤ºä¾‹ä»£ç **ï¼ŒåŸºäº
 âœ… Spring Boot
 âœ… Netty
 âœ… Spring Data Redis

æˆ‘ç»™ä½ ä¸€ä»½å®Œæ•´å¯ç†è§£çš„ç‰ˆæœ¬ï¼ˆå…³é”®ç±»é½å…¨ï¼Œè¶³å¤Ÿä½ ç›´æ¥è®²ç»™é¢è¯•å®˜æˆ–åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼‰ã€‚

------

#### ğŸ§© ä¸€ã€æ€»ä½“é€»è¾‘

> æœåŠ¡ç«¯å‘é€æ¶ˆæ¯æ—¶ â†’ å­˜ Redis ç­‰å¾… ACK
>  å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯å â†’ å›å¤ ACK
>  æœåŠ¡ç«¯æ”¶åˆ° ACK â†’ åˆ é™¤ Redis è®°å½•
>  å®šæ—¶ä»»åŠ¡æ‰«æ Redis â†’ é‡å‘æœªç¡®è®¤æ¶ˆæ¯

------

#### ğŸ§± äºŒã€ä»£ç ç»“æ„

```java
com.chat.server
 â”œâ”€â”€ WebSocketSessionManager.java     // ç®¡ç†ç”¨æˆ·è¿æ¥
 â”œâ”€â”€ MessageService.java               // å‘é€/ACKé€»è¾‘
 â”œâ”€â”€ AckScheduler.java                 // å®šæ—¶æ‰«æé‡å‘
 â”œâ”€â”€ ChatMessage.java                  // æ¶ˆæ¯å®ä½“
 â”œâ”€â”€ NettyServerHandler.java           // å¤„ç†æ¶ˆæ¯&ACK
 â””â”€â”€ RedisConfig.java                  // Redisé…ç½®
```

------

#### âœ… 1. ChatMessage.java

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class ChatMessage {
    private String msgId;        // æ¶ˆæ¯å”¯ä¸€IDï¼ˆUUIDï¼‰
    private Long fromUserId;
    private Long toUserId;
    private String type;         // text/image/file/ack
    private String content;
    private Long timestamp;
}
```

------

#### âœ… 2. WebSocketSessionManager.java

```java
@Component
public class WebSocketSessionManager {

    private static final Map<Long, Channel> USER_CHANNEL_MAP = new ConcurrentHashMap<>();

    public void bind(Long userId, Channel channel) {
        USER_CHANNEL_MAP.put(userId, channel);
    }

    public void remove(Long userId) {
        USER_CHANNEL_MAP.remove(userId);
    }

    public Channel getChannel(Long userId) {
        return USER_CHANNEL_MAP.get(userId);
    }
}
```

------

#### âœ… 3. MessageService.java ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

```java
@Service
public class MessageService {

    @Autowired
    private WebSocketSessionManager sessionManager;

    @Autowired
    private StringRedisTemplate redisTemplate;

    private static final String WAIT_ACK_KEY = "wait_ack:";
    private static final String OFFLINE_KEY = "offline:";

    /**
     * å‘é€æ¶ˆæ¯ï¼ˆå¸¦ACKæœºåˆ¶ï¼‰
     */
    public void sendMessage(ChatMessage msg) {
        Long toUserId = msg.getToUserId();
        Channel channel = sessionManager.getChannel(toUserId);

        if (channel != null && channel.isActive()) {
            // åœ¨çº¿å‘é€
            channel.writeAndFlush(new TextWebSocketFrame(JSON.toJSONString(msg)));
            // å­˜å…¥å¾…ç¡®è®¤åˆ—è¡¨
            redisTemplate.opsForValue().set(
                    WAIT_ACK_KEY + msg.getMsgId(),
                    JSON.toJSONString(msg),
                    60, TimeUnit.SECONDS
            );
        } else {
            // ä¸åœ¨çº¿åˆ™ç¦»çº¿å­˜å‚¨
            redisTemplate.opsForList().rightPush(OFFLINE_KEY + toUserId, JSON.toJSONString(msg));
        }
    }

    /**
     * æ”¶åˆ°ACK
     */
    public void handleAck(String msgId) {
        redisTemplate.delete(WAIT_ACK_KEY + msgId);
    }

    /**
     * æ¨é€ç¦»çº¿æ¶ˆæ¯
     */
    public void sendOfflineMessages(Long userId) {
        String key = OFFLINE_KEY + userId;
        List<String> list = redisTemplate.opsForList().range(key, 0, -1);
        if (list != null) {
            for (String json : list) {
                ChatMessage msg = JSON.parseObject(json, ChatMessage.class);
                sendMessage(msg);
            }
            redisTemplate.delete(key);
        }
    }
}
```

------

#### âœ… 4. AckScheduler.java ï¼ˆè‡ªåŠ¨é‡å‘ï¼‰

```java
@Component
@EnableScheduling
public class AckScheduler {

    @Autowired
    private StringRedisTemplate redisTemplate;

    @Autowired
    private MessageService messageService;

    private static final String WAIT_ACK_KEY = "wait_ack:";

    @Scheduled(fixedDelay = 10000) // æ¯10ç§’æ‰«æ
    public void checkUnAckMessages() {
        Set<String> keys = redisTemplate.keys(WAIT_ACK_KEY + "*");
        if (keys == null || keys.isEmpty()) return;

        for (String key : keys) {
            String json = redisTemplate.opsForValue().get(key);
            if (json != null) {
                ChatMessage msg = JSON.parseObject(json, ChatMessage.class);
                System.out.println("ã€é‡å‘æ¶ˆæ¯ã€‘msgId=" + msg.getMsgId());
                messageService.sendMessage(msg);
            }
        }
    }
}
```

------

#### âœ… 5. NettyServerHandler.java ï¼ˆå¤„ç†æ”¶å‘ + ACKï¼‰

```java
@ChannelHandler.Sharable
@Component
public class NettyServerHandler extends SimpleChannelInboundHandler<TextWebSocketFrame> {

    @Autowired
    private WebSocketSessionManager sessionManager;

    @Autowired
    private MessageService messageService;

    @Override
    protected void channelRead0(ChannelHandlerContext ctx, TextWebSocketFrame frame) {
        String text = frame.text();
        ChatMessage msg = JSON.parseObject(text, ChatMessage.class);

        switch (msg.getType()) {
            case "connect" -> {
                // å®¢æˆ·ç«¯è¿æ¥ï¼Œç»‘å®šuserId
                sessionManager.bind(msg.getFromUserId(), ctx.channel());
                messageService.sendOfflineMessages(msg.getFromUserId());
            }
            case "ack" -> {
                // æ”¶åˆ°ACK
                messageService.handleAck(msg.getMsgId());
            }
            default -> {
                // æ™®é€šæ¶ˆæ¯
                msg.setMsgId(UUID.randomUUID().toString());
                msg.setTimestamp(System.currentTimeMillis());
                messageService.sendMessage(msg);
            }
        }
    }

    @Override
    public void handlerRemoved(ChannelHandlerContext ctx) {
        // æ–­çº¿æ¸…ç†
        sessionManager.getChannelMap().entrySet().removeIf(e -> e.getValue().equals(ctx.channel()));
    }
}
```

### é¢è¯•æ€»ç»“è¯æœ¯ï¼ˆæ¨èèƒŒï¼‰

æˆ‘å®ç°äº†ä¸€ä¸ªåŸºäº Redis çš„æ¶ˆæ¯å¯é æŠ•é€’æœºåˆ¶ã€‚
 æ¯æ¡æ¶ˆæ¯å‘é€åéƒ½ä¼šå­˜å…¥ `wait_ack:{msgId}`ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿”å› ACKã€‚
 æ”¶åˆ° ACK ååˆ é™¤ Redis è®°å½•ï¼›
 è‹¥è¶…æ—¶æœªç¡®è®¤ï¼Œåˆ™ç”±å®šæ—¶ä»»åŠ¡æ£€æµ‹å¹¶è‡ªåŠ¨é‡å‘ï¼Œç¡®ä¿æ¶ˆæ¯â€œè‡³å°‘é€è¾¾ä¸€æ¬¡â€ã€‚
 åŒæ—¶æ”¯æŒç¦»çº¿ç¼“å­˜ä¸æ–­çº¿é‡æ¨ï¼Œå®ç°äº†ç«¯åˆ°ç«¯çš„å¯é é€šä¿¡é—­ç¯



## **éš¾ç‚¹ 2ï¼šå¤šèŠ‚ç‚¹æ¶ˆæ¯åŒæ­¥ä¸é›†ç¾¤å¯æ‰©å±•æ€§**

å•èŠ‚ç‚¹ WebSocket æœåŠ¡å¾ˆå®¹æ˜“å®ç°ï¼Œä½†åœ¨éƒ¨ç½²å¤šèŠ‚ç‚¹æ—¶ï¼Œç”¨æˆ· A è¿åœ¨èŠ‚ç‚¹ 1ï¼Œç”¨æˆ· B è¿åœ¨èŠ‚ç‚¹ 2ï¼Œè¿™æ—¶æ¶ˆæ¯å¦‚ä½•è½¬å‘æ˜¯ä¸ªéš¾ç‚¹ã€‚
 **è§£å†³æ–¹æ¡ˆï¼š**

- ä½¿ç”¨ **Redisson çš„ Topic å‘å¸ƒè®¢é˜…æœºåˆ¶** å®ç°èŠ‚ç‚¹é—´æ¶ˆæ¯å¹¿æ’­ï¼›
- å½“ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œé€šè¿‡ Redis Topic é€šçŸ¥å…¶ä»–èŠ‚ç‚¹ï¼›
- ç›®æ ‡èŠ‚ç‚¹åˆ¤æ–­è‡ªå·±æ˜¯å¦æŒæœ‰ç›®æ ‡ç”¨æˆ·çš„è¿æ¥ï¼Œè‹¥æœ‰åˆ™ç›´æ¥æ¨é€ã€‚
   è¿™æ ·å°±å®ç°äº†**è·¨èŠ‚ç‚¹å®æ—¶é€šä¿¡**ï¼Œç³»ç»Ÿå¯ä»¥**æ°´å¹³æ‰©å±•**ã€‚

ğŸ§  **äº®ç‚¹å…³é”®è¯**ï¼š

> â€œRedisson å‘å¸ƒè®¢é˜…â€ã€â€œåˆ†å¸ƒå¼æ¶ˆæ¯è·¯ç”±â€ã€â€œæ°´å¹³æ‰©å±•â€ã€â€œèŠ‚ç‚¹é—´çŠ¶æ€åŒæ­¥â€ã€‚

------

###  ä»£ç å®ç°

#### 1ï¸âƒ£ Redisson é…ç½®ç±»

```java
@Configuration
public class RedissonConfig {

    @Bean
    public RedissonClient redissonClient() {
        Config config = new Config();
        // å•èŠ‚ç‚¹æ¨¡å¼ï¼Œå¯æ”¹ä¸º cluster
        config.useSingleServer()
                .setAddress("redis://127.0.0.1:6379")
                .setDatabase(0);
        return Redisson.create(config);
    }
}
```

------

#### 2ï¸âƒ£ å®šä¹‰æ¶ˆæ¯å‘å¸ƒæœåŠ¡ï¼ˆå‘å¸ƒè€…ï¼‰

```java
@Service
public class MessagePublisher {

    private final RedissonClient redissonClient;

    public static final String TOPIC_NAME = "chat_message_topic";

    @Autowired
    public MessagePublisher(RedissonClient redissonClient) {
        this.redissonClient = redissonClient;
    }

    /** å‘å¸ƒæ¶ˆæ¯åˆ° Redis é¢‘é“ */
    public void publish(MessageSendDto msg) {
        RTopic topic = redissonClient.getTopic(TOPIC_NAME);
        topic.publish(msg);
    }
}
```

------

#### 3ï¸âƒ£ å®šä¹‰è®¢é˜…ç›‘å¬å™¨ï¼ˆè®¢é˜…è€…ï¼‰

> æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨è®¢é˜… Redis Topicï¼Œå½“æœ‰å…¶ä»–èŠ‚ç‚¹å‘æ¥æ¶ˆæ¯æ—¶ä¼šè‡ªåŠ¨æ¥æ”¶ã€‚

```java
@Service
public class MessageSubscriber {

    private final RedissonClient redissonClient;

    @Autowired
    private WebSocketService webSocketService; // ç®¡ç†æœ¬èŠ‚ç‚¹çš„channelè¿æ¥

    @PostConstruct
    public void init() {
        RTopic topic = redissonClient.getTopic(MessagePublisher.TOPIC_NAME);
        topic.addListener(MessageSendDto.class, (channel, msg) -> {
            // æ”¶åˆ°å…¶ä»–èŠ‚ç‚¹å‘å¸ƒçš„æ¶ˆæ¯
            handleRemoteMessage(msg);
        });
    }

    public MessageSubscriber(RedissonClient redissonClient) {
        this.redissonClient = redissonClient;
    }

    private void handleRemoteMessage(MessageSendDto msg) {
        // åˆ¤æ–­ç›®æ ‡ç”¨æˆ·æ˜¯å¦è¿æ¥åœ¨æœ¬èŠ‚ç‚¹
        Channel channel = WebSocketService.USER_CHANNEL_MAP.get(msg.getRecipientId());
        if (channel != null && channel.isActive()) {
            channel.writeAndFlush(new TextWebSocketFrame(JSON.toJSONString(msg)));
        }
    }
}
```

### é¢è¯•å¯è¯´çš„æ€»ç»“è¯æœ¯

åœ¨å¤šèŠ‚ç‚¹éƒ¨ç½²æ—¶ï¼Œæˆ‘ä½¿ç”¨äº† Redisson çš„å‘å¸ƒè®¢é˜…æœºåˆ¶ã€‚
 å½“ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šå°†æ¶ˆæ¯å‘å¸ƒåˆ° Redis Topicï¼Œ
 å…¶ä»–èŠ‚ç‚¹ç›‘å¬è¯¥ Topicï¼Œå¦‚æœç›®æ ‡ç”¨æˆ·è¿æ¥åœ¨å½“å‰èŠ‚ç‚¹ï¼Œå°±ç›´æ¥æ¨é€ã€‚
 è¿™æ ·å°±å®ç°äº†åˆ†å¸ƒå¼çš„ WebSocket æ¶ˆæ¯åŒæ­¥ä¸ç³»ç»Ÿæ°´å¹³æ‰©å±•



## **éš¾ç‚¹ 3ï¼šå®¢æˆ·ç«¯ç¦»çº¿æ¶ˆæ¯ä¸æœ¬åœ°ç¼“å­˜**

æ¡Œé¢å®¢æˆ·ç«¯ä½¿ç”¨ **Electron + SQLite**ï¼Œå®ç°èŠå¤©è®°å½•ç¦»çº¿å¯æŸ¥ã€æ–­ç½‘é‡è¿è‡ªåŠ¨åŒæ­¥ã€‚
 **æŠ€æœ¯è¦ç‚¹ï¼š**

- å½“ç”¨æˆ·æ‰çº¿æ—¶ï¼Œæ¶ˆæ¯æš‚å­˜åœ¨æœ¬åœ° SQLiteï¼›
- é‡è¿åä¼šå‘èµ·ä¸€ä¸ªâ€œæ¶ˆæ¯åŒæ­¥è¯·æ±‚â€ï¼Œæ ¹æ®æ—¶é—´æˆ³ä»æœåŠ¡ç«¯æ‹‰å–æœªè¯»æ¶ˆæ¯ï¼›
- ç¦»çº¿å’Œåœ¨çº¿æ¶ˆæ¯ç»Ÿä¸€å­˜å‚¨ç»“æ„ï¼Œå‰ç«¯æ¸²æŸ“é€»è¾‘ä¿æŒä¸€è‡´ã€‚

ğŸ§  **äº®ç‚¹å…³é”®è¯**ï¼š

> â€œæœ¬åœ°ç¦»çº¿ç¼“å­˜â€ã€â€œå¢é‡åŒæ­¥â€ã€â€œSQLite æœ¬åœ°åŒ–å­˜å‚¨â€ã€â€œæ–­ç½‘å¯ç”¨â€ã€‚



## **éš¾ç‚¹ 4ï¼šç»Ÿè®¡åœ¨çº¿ç”¨æˆ·**

ZSet æœ¬èº«æ˜¯ä¸€ä¸ª `(member, score)` å¯¹çš„é›†åˆï¼Œ
 æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥åŒæ—¶å­˜å‚¨ï¼š

- ç”¨æˆ·IDï¼ˆ`member`ï¼‰
- æœ€è¿‘ä¸€æ¬¡å¿ƒè·³æ—¶é—´æˆ³ï¼ˆ`score`ï¼‰

è¿™æ„å‘³ç€ï¼š

- ç”¨æˆ·æ˜¯å¦åœ¨çº¿ï¼ŸğŸ‘‰ åˆ¤æ–­ `score` æ˜¯å¦åœ¨ã€Œæœ‰æ•ˆæ—¶é—´çª—å£ã€å†…ã€‚
- åœ¨çº¿äººæ•°ï¼ŸğŸ‘‰ æŸ¥è¯¢æ—¶é—´çª—å£å†…çš„æˆå‘˜æ•°ã€‚
- åœ¨çº¿åˆ—è¡¨ï¼ŸğŸ‘‰ ç›´æ¥å–å‡ºæœ‰æ•ˆç”¨æˆ·çš„ IDã€‚

> ğŸ’¡ æ‰€ä»¥ï¼Œåªç”¨ **ä¸€ä¸ª Keyï¼ˆä¸€ä¸ª ZSetï¼‰** å°±èƒ½å®ç°ï¼š
>
> - åœ¨çº¿çŠ¶æ€è®°å½•
> - TTLåˆ¤æ–­ï¼ˆé€šè¿‡æ—¶é—´æˆ³ï¼‰
> - åœ¨çº¿äººæ•°ç»Ÿè®¡

### ä»£ç å®ç°

```java
@Service
public class OnlineUserService {

    private static final String ONLINE_ZSET_KEY = "chat:online_users";
    private static final long EXPIRE_TIME_MS = 60 * 1000; // å¿ƒè·³60ç§’æœ‰æ•ˆ

    @Autowired
    private StringRedisTemplate redisTemplate;

    /** ç”¨æˆ·ä¸Šçº¿æˆ–å¿ƒè·³åˆ·æ–° */
    public void refreshOnlineUser(String userId) {
        double now = System.currentTimeMillis();
        redisTemplate.opsForZSet().add(ONLINE_ZSET_KEY, userId, now);
    }

    /** ç”¨æˆ·ä¸‹çº¿ */
    public void removeUser(String userId) {
        redisTemplate.opsForZSet().remove(ONLINE_ZSET_KEY, userId);
    }

    /** è·å–åœ¨çº¿äººæ•° */
    public long getOnlineCount() {
        double now = System.currentTimeMillis();
        Double start = now - EXPIRE_TIME_MS;
        Long count = redisTemplate.opsForZSet()
                .count(ONLINE_ZSET_KEY, start, now);
        return count == null ? 0 : count;
    }

    /** è·å–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ */
    public Set<String> getOnlineUsers() {
        double now = System.currentTimeMillis();
        Double start = now - EXPIRE_TIME_MS;
        return redisTemplate.opsForZSet()
                .rangeByScore(ONLINE_ZSET_KEY, start, now);
    }

    /** å®šæ—¶æ¸…ç†è¿‡æœŸç”¨æˆ· */
    @Scheduled(fixedDelay = 60000)
    public void cleanOfflineUsers() {
        double expireBefore = System.currentTimeMillis() - EXPIRE_TIME_MS;
        redisTemplate.opsForZSet().removeRangeByScore(ONLINE_ZSET_KEY, 0, expireBefore);
    }
}

```

### äº®ç‚¹æ€»ç»“ï¼ˆé¢è¯•å›ç­”æ¨¡æ¿ï¼‰

> â€œåœ¨çº¿ç”¨æˆ·æˆ‘ç”¨ Redis çš„ ZSet åšäº†ä¸€ä½“åŒ–è®¾è®¡ï¼Œ
>  æ¯ä¸ªç”¨æˆ·çš„ ID ä½œä¸º memberï¼Œæœ€åå¿ƒè·³æ—¶é—´ä½œä¸º scoreã€‚
>  è¿™æ ·æ—¢èƒ½ç»Ÿè®¡åœ¨çº¿äººæ•°ï¼Œåˆèƒ½é€šè¿‡æ—¶é—´åˆ¤æ–­æ˜¯å¦è¿‡æœŸã€‚
>  æ— éœ€ä¸¤ä¸ªç»“æ„å°±èƒ½å®ç°åˆ†å¸ƒå¼å…±äº«ã€è‡ªåŠ¨è¿‡æœŸæ¸…ç†ï¼Œ
>  æ€§èƒ½æ¯”å•ç‹¬ç»´æŠ¤ Set + TTL æ›´é«˜ï¼Œä¹Ÿæ›´æ˜“æ‰©å±•ã€‚â€



## ç®€åŒ–ç‰ˆå£è¿°æ¨¡æ¿ï¼ˆé¢è¯•æ—¶è¯´æ³•ï¼‰

> è¿™ä¸ªé¡¹ç›®æˆ‘åœ¨å®ç°è¿‡ç¨‹ä¸­ä¸»è¦é‡åˆ°çš„éš¾ç‚¹æœ‰ä¸¤ä¸ªï¼š
>  ä¸€ä¸ªæ˜¯ **WebSocket é•¿è¿æ¥çš„åˆ†å¸ƒå¼ç®¡ç†ä¸æ¶ˆæ¯å¯é æŠ•é€’**ï¼Œæˆ‘é€šè¿‡ **Netty + Redisson** å®ç°äº†å¤šèŠ‚ç‚¹æ¶ˆæ¯åŒæ­¥ï¼Œå¹¶ç»“åˆå¿ƒè·³æ£€æµ‹å’Œ ACK ç¡®è®¤æœºåˆ¶ï¼Œä¿è¯æ¶ˆæ¯åœ¨æ–­çº¿ã€ç¦»çº¿æƒ…å†µä¸‹ä¹Ÿèƒ½å¯é é€è¾¾ï¼›
>  ç¬¬äºŒä¸ªæ˜¯å®¢æˆ·ç«¯çš„ **ç¦»çº¿æ¶ˆæ¯ç¼“å­˜ä¸é‡è¿åŒæ­¥æœºåˆ¶**ï¼Œæˆ‘ç”¨ **Electron + SQLite** å®ç°äº†æ¶ˆæ¯æœ¬åœ°æŒä¹…åŒ–å’Œå¢é‡åŒæ­¥ï¼Œç”¨æˆ·æ–­ç½‘ä¹Ÿèƒ½æŸ¥çœ‹èŠå¤©è®°å½•ã€‚
>
> åœ¨åˆ›æ–°ç‚¹æ–¹é¢ï¼Œæˆ‘åšäº† **WebRTC ç‚¹å¯¹ç‚¹é€šè¯**ï¼Œè®©éŸ³è§†é¢‘æµä¸ç»è¿‡æœåŠ¡ç«¯ä¸­è½¬ï¼Œå»¶è¿Ÿå’Œå¸¦å®½å ç”¨éƒ½æ˜¾è‘—é™ä½ã€‚
>  åŒæ—¶æ•´ä¸ªå®¢æˆ·ç«¯æ˜¯ **è·¨å¹³å°çš„ Electron åº”ç”¨**ï¼Œæ”¯æŒæˆªå›¾ã€æ–‡ä»¶å‘é€å’Œæœ¬åœ°é¢„è§ˆï¼Œä½“éªŒæ›´æ¥è¿‘åŸç”Ÿ IMã€‚